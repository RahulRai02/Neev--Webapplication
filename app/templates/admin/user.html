{% extends 'layout.html'%}
{% block content %}
<div class="container">
  <h1>Beneficiary Page</h1>
  <div class="container">
    <form name="searchForm" method="POST">
      <input type="hidden" name="signal" value="search">
      <div class="form-group">
        <label for="name">Name:</label>
        <input type="text" class="form-control" id="name" name="name">
      </div>
      <div class="form-group">
        <label for="id">Aadhar ID:</label>
        <input type="text" class="form-control" id="id" name="aadhar">
      </div>
      <div class="form-group">
        <label for="dob">DOB:</label>
        <input type="date" class="form-control" id="dob" name="dob">
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>

      <!-- Rendering search results -->
  <table class="table">



    <tbody>
      {% if searchResults|length == 0 %}
        No Search Results
      {% else %}
        <thead>
          <tr>
            <th scope="col">Aadhar ID </th>
            <th scope="col">Name</th>
            <th scope="col">DOB </th>
            <th scope="col">Gender </th>
            <th scope="col">Education</th>
            <th scope="col">Martial Status</th>
            <th scope="col">Employed</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
      {% endif %}

      {% for user in searchResults %}
      <tr>
        <th scope="row" headers="aadhar">{{user[0]}}</th>
        <td headers="name">{{user[1]}}</td>
        <td headers="dob">{{user[2]}}</td>
        <td headers="gender">{{user[3]}}</td>
        <td headers="education">{{user[5]}}</td>
        <td headers="martial">{{user[4]}}</td>
        <td headers="employed">{{user[7]}}</td>
        <td>
          <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editModal"
            onclick="edit(this)">Edit</button>
          <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
            onclick="delete_user(this)" data-target="#deleteModal">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  </div>

  <div class="container">
    <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#addModal" onclick="">Add New
      Beneficiary</button>

  </div>

  <!-- Rendering Table -->
  <table class="table">

    <thead>
      <tr>
        <th scope="col">Aadhar ID </th>
        <th scope="col">Name</th>
        <th scope="col">DOB </th>
        <th scope="col">Gender </th>
        <th scope="col">Education</th>
        <th scope="col">Martial Status</th>
        <th scope="col">Employed</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <!-- dummy data -->
    <tbody>
      {% for user in userDetails %}
      <!-- print(userDetails) -->
      <tr>

        <th scope="row" headers="aadhar">{{user[0]}}</th>
        <td headers="name">{{user[1]}}</td>
        <td headers="dob">{{user[2]}}</td>
        <td headers="gender">{{user[3]}}</td>
        <td headers="education">{{user[5]}}</td>
        <td headers="martial">{{user[4]}}</td>
        <td headers="employed">{{user[7]}}</td>
        <td>
          <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editModal"
            onclick="edit(this)">Edit</button>
          <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
            onclick="delete_user(this)" data-target="#deleteModal">Delete</button>
        </td>
      </tr>
      {% endfor %}

    </tbody>
  </table>


  <!-- edit modal  -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit User</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="editedDetails" method="POST">

            <input type="hidden" name="signal" value="edit">
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" class="form-control" id="name" name="name">
            </div>


            <div class="form-group">
              <label for="aadhar">Aadhar Id</label>
              <input type="number" class="form-control" id="email" name="aadhar" min="100000000000" max="999999999999">
            </div>


            <div class="form-group">
              <label for="dob">DOB</label>
              <input type="date" class="form-control" id="dob" name="dob">
            </div>


            <div class="form-group">
              <label for="education">Education</label>
              <input type="text" class="form-control" id="education" name="education">
            </div>

            <div class="form-group">
              <label for="genderSelect">Martial Status</label>
              <select class="form-control" id="genderSelect" name="martial">
                <option value="Married">Married</option>
                <option value="Unmarried">Unmarried</option>

              </select>
            </div>
            <div class="form-group">
              <label for="genderSelect">Gender</label>
              <select class="form-control" id="genderSelect" name="gender">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="genderSelect">Employed</label>
              <select class="form-control" id="genderSelect" name="employed">
                <option value="Yes">Yes</option>
                <option value="No">No</option>

              </select>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <input type="submit" class="btn btn-primary" id="saveChangesButton" value="Save Changes">
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>


  <!-- add modal -->
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Add New User</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form name="addDetails" method="POST">
            <input type="hidden" name="signal" value="add">

            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" class="form-control" id="name" name="name">
            </div>


            <div class="form-group">
              <label for="aadhar">Aadhar Id</label>
              <input type="number" class="form-control" id="email" name="aadhar" min="100000000000" max="999999999999">
            </div>


            <div class="form-group">
              <label for="dob">DOB</label>
              <input type="date" class="form-control" id="dob" name="dob">
            </div>


            <div class="form-group">
              <label for="education">Education</label>
              <input type="text" class="form-control" id="education" name="education">
            </div>

            <div class="form-group">
              <label for="genderSelect">Martial Status</label>
              <select class="form-control" id="genderSelect" name="martial">
                <option value="Unmarried">Unmarried</option>
                <option value="Married">Married</option>

              </select>
            </div>
            <div class="form-group">
              <label for="genderSelect">Gender</label>
              <select class="form-control" id="genderSelect" name="gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="genderSelect">Employed</label>
              <select class="form-control" id="genderSelect" name="employed">
                <option value="Yes">Yes</option>
                <option value="No">No</option>

              </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveChangesButton">Add</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>


  <!-- delete modal  -->
  <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Delete User</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this beneficiary?
        </div>
        <div class="modal-footer">
            <form name="deleteForm" method="POST">
                <div class="form-group">
                    <input type="hidden" name="signal" value="delete">
                    <label for="aadhar">Aadhar Id</label>
                    <input type="number" class="form-control" id="email" name="aadhar" min="100000000000" max="999999999999" readonly>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger" id="deleteButton">Delete</button>
                </div>
            </form>

        </div>
      </div>
    </div>
  </div>
</div>


<script>

      function edit(e) {
        let p = e.parentNode.parentNode;
        let name = p.querySelector("td[headers='name']").innerHTML;
        let aadhar = p.querySelector('th[headers="aadhar"]').innerHTML;
        let dob = p.querySelector('td[headers="dob"]').innerHTML;
        let education = p.querySelector('td[headers="education"]').innerHTML;
        let martial = p.querySelector('td[headers="martial"]').innerHTML;
        let gender = p.querySelector('td[headers="gender"]').innerHTML;
        let employed = p.querySelector('td[headers="employed"]').innerHTML;

        let form = document.querySelector("form[name='editedDetails']");

        form.querySelector("input[name='name']").value = name;
        form.querySelector("input[name='aadhar']").value = aadhar;
        form.querySelector("input[name='dob']").value = dob;
        form.querySelector("input[name='education']").value = education;
        form.querySelector("select[name='martial']").value = martial;
        form.querySelector("select[name='gender']").value = gender;
        form.querySelector("select[name='employed']").value = employed;
      }

      function delete_user(e) {
        let p = e.parentNode.parentNode;
        let aadhar = p.querySelector('th[headers="aadhar"]').innerHTML;
        console.log(aadhar)
        let form = document.querySelector("form[name='deleteForm']");

        form.querySelector("input[name='aadhar']").value = aadhar;
      }


</script>
{% endblock content %}